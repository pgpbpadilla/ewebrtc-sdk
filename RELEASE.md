# AT&T Enhanced WebRTC JS SDK

This SDK includes the following components:

* JavaScript library - a client library to consume the AT&T Enhanced WebRTC API.
* Node.js sample application - a web app demonstrating the features of the JavaScript library and managing application
  assets such as app key and app secret. **Please refer to `node-sample/RELEASE.md` for sample app-specific notes**.
* DHS Library - a Node.js library for generating OAuth access tokens and E911 IDs. **Please refer to
  `node-sample/lib/RELEASE.md` for DHS library specific notes**.

## Features of the JavaScript library

The following features and functionality are available in the current SDK release for all three supported calling types
 (AT&T Mobile Number, Virtual Number, and Account ID):

### Chrome v42

*	**Basic audio and video call management** – make, receive, answer, end, mute, unmute, hold, resume, cancel, and reject calls.
*	**Basic audio and video conferencing** – create a conference, add and remove participants, hold, resume, mute, unmute and end conference.
  *	Supports dialing out to add participants.
*	**Advanced call management** – move, add a second call, switch between two calls.
  *	Audio and video calls can be moved Web-to-Web
  *	Calls can be moved from the Web to an AT&T mobile phone

### Firefox

  *	**No SDK features are tested with Firefox**

### Upcoming features

The following features will be added soon:

*	Firefox browser support
*	Upgrade or downgrade between audio and video
*	DTMF (dialing) tones

# v1.0.0-rc.17

May 15, 2015

* **Fix**: Setting global logging level to trace throws JS error while making a call.
* **Fix**: Error during transferring the call.
* **Fix**: Video call quality on the call holder side is extremely poor following resume from hold.
* **Fix**: Transfer to a provisioned Phone fails when in a video call with Non-Provisioned phone.
* **Fix**: Transferring a call fails with HTTP error code `409` when an Account ID user transfers to a Mobile Device.

## Known Issues
* Downgrade fails after successful Call Move. 
  * Given that Alice is logged in Browser A and Browser B
  * And Bob is logged in a browser
  * And both are currently in a Video call
  * And Alice has successfully moved her call from Browser A to Browser B
  * When Bob tries to downgrade the Video call
  * Then the action fails with error `SVC0001:A service error has occurred. Error code is Parameter 'sdp' has invalid format.,Variables=Parameter 'sdp' has invalid format.`
* When moving a call using `Phone.move`, the error message `Unrecognized event state: move-terminated` is printed in the browser console. The move operation is successful. 
* When downgrading a call after successfully resuming it, the `Phone.downgrade` method fails with error message: `SVC0001:A service error has occurred. Error code is Parameter 'sdp' has invalid format.,Variables=Parameter 'sdp' has invalid format`. 
* When holding a call after successfully downgrading it, the `Phone.hold` method fails with error message: `SVC0001:A service error has occurred. Error code is Parameter 'sdp' has invalid format.,Variables=Parameter 'sdp' has invalid format`. 
* Downgrading muted call results in unmuted call on both sides. 
* Recipient can resume a call that has been held by hold initiator. 
* Transfer to a non-provsioned PSTN target fails while in video Call. 
* Media stream may not function correctly unless IPv6 is disabled. The default behavior is to use IPv4, so the developer doesn't need to explicitly disable IPv6. 
* When any user started a conference and invites a PSTN user and the user rejects the invitation. I don't get
invitation rejected event. 
* While using Chrome , adding Mobile Device as a participant to a conference hosted by Mobile Number
  results in one way audio with the notification `Media conference forbidden for this recipient`. 
* When in a call between a Mobile Number user using Firefox and a PSTN user if the Mobile Number user tries to move the
  call to it's Mobile phone, then he might see the following error:
  `Could not negotiate answer SDP; cause = SDP_PARSE_FAILED | SDP Parsing Error: c= connection line not specified for
   every media level, validation failed.` 
* Error not generated by library - scenarios that would result in the user having one call and one conference are not
  supported and thus should generate an error. 
* When initially loading the Sample app (`https://127.0.0.1:9001`) you will see the error:
  `NET::ERR_CERT_AUTHORITY_INVALID`. 
  * Workaround: Add a security exception by clicking `Advanced` and then click on `Proceed to 127.0.0.1 (unsafe)`
* While using Firefox, when removing a participant from a conference you could see the following error:
 `ReferenceError: event is not defined sample.js:593`
* While using Firefox, calling a PSTN number could result in the following errors :
  * `Renegotiation of session description is not currently supported. See Bug 840728 for status.`
    The call is established and the users can hear each other.
  * `Could not negotiate answer SDP; cause = SDP_PARSE_FAILED | SDP Parsing Error: Warning: Unrecognized attribute
    (ice-mismatch) | SDP Parsing Error: c= connection line not specified for every media level, validation failed.s`.
    The call is established but the users cannot hear each other.
* Canceling to give consent to a Mobile Number results in redirecting the user to an access denied error page. 
* Resuming a video conference from the participant side results in no video on both host and participant sides. 
* A background call will auto resume if the user moves his call to another device. 
* Switching to the background call on Chrome Windows results in no media in the call. 
* Adding (non-provisioned) Mobile Device as a participant to a conference results in one way audio with the notification
  `Media conference forbidden for this recipient`. 
* Adding Account ID participant to a conference when the host is Virtual Number fails with message: `User Not Found`. 
* List of participants is not cleared when ending a conference. 
* `call:move-terminated` event is not fired when successfully completing `phone.move`.
* Adding multiple participants at once using `Phone.addParticipants` method fails with error:
  `SVC8501:MediaConference ongoing update participant operation.,Variables=`. Use `Phone.addParticipants`
  with a single participant ID (Mobile Number, Account ID, Virtual Number) and wait for that participant to
  successfully join (i.e., event `conference:invitation-accepted`), then invite the next participant.
* When a participant leaves a conference by using the `endConference` method, the platform does not generate
  the necessary event to inform the host.
* When an Mobile Number user rejects an invitation for a conference, sometimes the event `conference:ended` will not
  be published due to a bug at the platform level.
* When adding a participant to a conference, sometimes the error: `The requested conference ID <id> was not found.`
  is shown.
* Video switching between participants is sometimes inconsistent. Turn off your microphone while the other participant
  speaks, that will switch the video to the speaking participant.

## Notes

* Establishing calls with Firefox is notably slower than doing so with Chrome.

## Tested Environments

* Chrome Version 42.0 for OSX v10.8.5 and Windows 8

**_The SDK may also work for other Operating Systems, other Browsers but is not tested or supported._**


# Changelog


## v1.0.0-rc.16

April 16, 2015

* **New**: New `ATT.logManager` features
  * `getLogLevels`: Method to get all defined log levels for log manager.
  * `getCurrentModuleLogLevels`: Method to get the current modules with their defined log levels.
  * `getGlobalLogLevel`: Method to get the current log level for all modules.
  * `setGlobalLogLevel`: Method to set a log level for all the modules.
  * `resetLogLevels`: Method to reset log levels for all modules to their defaults.
  * `getLoggers`: Method to get log manager's list of modules.
  * `getModuleDefaults`: Method to get the modules with defined default log levels.
  * `createCustomLogger`: Method to create a custom logger by passing a module name.
  * `deleteCustomLogger`: Method to delete a custom logger by passing a module name.
* **Changed**: Changed `ATT.logManager` feature
    * `getLogger`: Method to get the logger object by passing the module name.
* **Removed**: Removed from `ATT.logManager`
  * `addLoggerForModule`
  * `configureLogger`
  * `getLoggerByName`
  * `logLevel`
  * `loggerType`
  * `LOG_LEVEL`
  * `LOGGER_TYPE`
* **New**: New `ATT.logManager.Logger` features
  * `isCustomType`: Returns true if a custom Logger
  * `setLogLevel`: Sets log level of Logger
  * `getLogLevel`: Gets log level of Logger
* **Removed**: Removed from `ATT.logManager.Logger`
  * `level`
  * `setLevel`
  * `setType`
  * `Type`
* **New:** Methods to manage configuration for `RTCPeerConnection`.
  * `getIceServers`: Function to get the current ICE servers that the SDK uses for creating peer connections.
  * `setIceServers`: Method to set the list of ICE server that the SDK uses for creating peer connections.
  * `resetIceServers`: Method to reset the list of ICE servers to default list for peer connection configuration.
  * `getIceTransport`: Function to get the current ICE transport value that the SDK uses for creating peer
 connections.
  * `setIceTransport`: Method to set the ICE transport that the SDK uses for creating peer connections.
  * `resetIceTransport`: Method to reset the ICE transport value to the value for peer connection configuration.
  * `getIpv6`: Function to get the ipv6 value that the SDK uses for creating peer connections.
  * `setIpv6`: Method to set the ipv6 value that the SDK uses for creating peer connections.
  * `resetIpv6`: Method to reset the ipv6 to the default value for peer connection configuration.

## v1.0.0-rc.15

April 3, 2015

* **Fix:** Users are not able to login again using the same Access Token.
* **Fix:** SDK can dial second call by putting the previous call automatically on hold.
* **Fix:** Video stream dropped when video call is on hold for 15 minutes or more, and the call is resumed.


## v1.0.0-rc.14

March 22, 2015

* **New:** DHS functions are now available as public node module named  as`att-dhs`. You can use this like regular node modules.
* **Removed:**
 * Stand-alone node-dhs is removed. DHS functions are now available it `att-dhs` public node module. You can user these DHS functions in your own NodeJS App. An illustrative example is provided in node-sample.
 * ATT.rtc.dhs namespace is deleted, instead use migration guide for code snippets to invoke sample app DHS routes.
 * ATT.rtc.configure method is no longer needed.
* **Removed:**
 * DHS routes are now in node-sample.
 * `restify-dhs` is optional, use this only if you want a stand-alone node-dhs.
* **Fix:** `phone.logout` method will always return after cleaning session and call resources if any.

## v1.0.0-rc.13

March 6, 2015

* **Fix:** Call index is the same for 2 calls in phone.getCalls().
* **New:** DHS Library: A new server side node based library to provide oAuth token and E911 Id methods
    * This will replace a separate server for DHS
    * The DHS specific configuration (app key/secret etc) can now be done on the sample server itself
    * Please refer to DHS Library JsDocs and README for further information
* **Change** The following SDK methods are changed. **Please update your web application accordingly**
    * ATT.rtc.dhs.createAccessToken is now ATT.rtc.createAccessToken
    * ATT.rtc.dhs.createE911Id is now ATT.rtc.createE911Id
    * ATT.rtc.configure now has a new signature. Please refer to SDK API JsDocs for updates to this method
* **Change** The sample app can now be launched by navigating to `https://localhost:9001`.
    * You still need to add the security exception for `https://localhost:9001` on your browser.
    * Please refer to the README for more information



## v1.0.0-rc.12

February 20, 2015

* **Fix:** Multiple errors (Login Failed) appear in succession are concatenating when page is not refreshed .
* **Fix:** No audio on handset following call move.
* **Fix:** move call unnecessarily fires call:connected and media:established events and throws js exception.

* **New:** The Call-id in the event object will be a complete uri instead of parsed numbers or ID.
  * Added a new method getCallerInfo(callerUri) to parse the raw URI to the return the information like callerId,
   protocol, domain, port and other associated information.


## v1.0.0-rc.11

February 6, 2015

* **Fix:** Now the DHS and the Sample App use the IP address `127.0.0.1` instead of the hostname `localhost` so that the developer only has to add the SSL security exception once.
* **Fix:** Video Camera Still on when disconnecting the Call.
* **Fix:** Unable to uniquely track 2 calls to the same number. QC 74097.
  * Event data associated with call/conference event now has `index` that refers to ordinal numbering of the call in the list of existing calls
  * Public method `phone.getCalls` updated to return call `index`, `breed`, `type`, `state` and `peer`/`participants`
* **New:** The Developer Hosted Server now uses AT&T OAuth v4.0.

## v1.0.0-rc.10

January 22, 2015

* **Fix:** the `Phone` object will publish an error event on invalid scenarios for second call. The second call feature only supports scenarios that would result in the user having two simple calls, one call in the background (inactive) and one call in the foreground (active). Scenarios that would result in the user having one call and one conference are not supported and thus will generate an error.
* **Fix:** `Phone.transfer` fails with error `Transfer terminated by Network` when the transfer target is an Account ID or Virtual Number user.
* **Fix:** corrects various typos in log statements.
* **Fix:** moving a call fails when the call is put on hold before invoking `Phone.move`.
* **Change:** use short user name on `Phone` events (`event.from` and `event.to`)
  * Account ID: `sip:user@domain.com` => `user`
  * Mobile Number: `sip:1234567890@domain.com` => `1234567890`
  * Virtual User: `tel:+1234567890` => `1234567890`
* **New:** the `Phone` object will publish the `session:expired` event when the library detects that the current session has expired in the server. See the documentation for details in the payload of the event.
* **New:** method `ATT.browser.isNetworkConnected` to check for network connectivity.

## v1.0.0-rc.9

December 31, 2014

* Enhancement: added 'session:expired' event to the phone object
* Enhancement: improves call establishment time.
* Change: less verbose logging.
* Change: provide full user name on event data for all phone events.

## v1.0.0-rc.7

### Features

#### Chrome v39

*	Basic audio and video call management – make, receive, answer, end, mute, unmute, hold, resume, cancel, and reject calls
*	Basic audio and video conferencing – create a conference, add and remove participants, hold, resume, mute, unmute and end conference
*	Advanced call management – move, transfer, add a second call, switch between two calls
*	Audio and video calls can be moved browser-to-browser
*	Audio calls can be moved from the browser to an AT&T mobile phone.


#### Firefox v33

*	Basic audio and video call management – make, receive, answer, end, mute, unmute, hold, resume, cancel, and reject calls
*	Basic audio and video conferencing – create a conference, add and remove participants, hold, resume, mute, unmute and end conference
